<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstudoFlow - Sistema de Revis√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #eef2ff;
            --sidebar: #0f172a;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); display: flex; min-height: 100vh; }

        /* --- SIDEBAR RESTAURADA (PONTO 2) --- */
        nav { width: 280px; background: var(--sidebar); color: white; display: flex; flex-direction: column; position: fixed; height: 100vh; padding: 30px 20px; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; color: #fff; }
        .nav-group { margin-bottom: 30px; }
        .nav-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: #475569; margin-bottom: 15px; display: block; font-weight: 700; }
        .nav-item { 
            padding: 12px 16px; border-radius: 12px; margin-bottom: 6px; cursor: pointer; 
            display: flex; align-items: center; gap: 12px; transition: 0.2s; color: #94a3b8; text-decoration: none; font-weight: 500;
        }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }

        /* --- CONTE√öDO PRINCIPAL --- */
        main { margin-left: 280px; padding: 40px; width: 100%; max-width: 1200px; }
        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 40px; }
        .header h1 { font-size: 1.8rem; font-weight: 800; color: var(--sidebar); }

        /* --- GRID DE LAYOUT --- */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 380px; gap: 30px; align-items: start; }

        /* --- CARDS --- */
        .card { background: var(--card); border-radius: 20px; padding: 25px; border: 1px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card-title { font-size: 1rem; font-weight: 700; margin-bottom: 20px; color: var(--sidebar); display: flex; align-items: center; gap: 8px; }

        /* --- STATS / RELAT√ìRIOS --- */
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .stat-card { padding: 20px; border-radius: 16px; background: var(--primary-light); text-align: center; border: 1px solid rgba(79, 70, 229, 0.1); }
        .stat-num { display: block; font-size: 1.8rem; font-weight: 800; color: var(--primary); }
        .stat-desc { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }

        /* --- FILTROS (RESTAURADOS) --- */
        .filter-section { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-chip { 
            padding: 8px 18px; border-radius: 100px; background: #fff; border: 1px solid var(--border); 
            font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .filter-chip.active { background: var(--sidebar); color: #fff; border-color: var(--sidebar); }

        /* --- LISTA DE REVIS√ïES V13 --- */
        .rev-card { 
            background: #fff; padding: 20px; border-radius: 18px; border: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; transition: 0.2s;
        }
        .rev-card:hover { transform: translateY(-2px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .subject-badge { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; padding: 4px 10px; border-radius: 6px; background: var(--primary-light); color: var(--primary); margin-bottom: 6px; display: inline-block; }
        .topic-title { font-weight: 700; font-size: 1.05rem; display: block; color: var(--sidebar); }
        .date-tag { font-size: 0.8rem; color: var(--text-muted); margin-top: 8px; display: flex; align-items: center; gap: 5px; }

        /* --- BOT√ïES DE A√á√ÉO --- */
        .actions { display: flex; gap: 10px; }
        .btn-circle { width: 42px; height: 42px; border-radius: 12px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; transition: 0.2s; }
        .btn-check { background: #dcfce7; color: #15803d; }
        .btn-check:hover { background: var(--success); color: #fff; }
        .btn-trash { background: #fee2e2; color: #b91c1c; }
        .btn-trash:hover { background: var(--danger); color: #fff; }

        /* --- FORMUL√ÅRIO --- */
        .input-box { margin-bottom: 15px; }
        .input-box label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 6px; color: var(--text-muted); }
        input, select { width: 100%; padding: 14px; border: 1px solid var(--border); border-radius: 12px; font-family: inherit; font-size: 0.95rem; background: #f8fafc; }
        .btn-save { width: 100%; padding: 16px; border-radius: 12px; border: none; background: var(--primary); color: #fff; font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-save:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 8px 15px rgba(79, 70, 229, 0.3); }

    </style>
</head>
<body>

    <nav>
        <div class="logo">üöÄ <span>EstudoFlow</span></div>
        
        <div class="nav-group">
            <span class="nav-label">Menu Principal</span>
            <a href="#" class="nav-item active">üè† Dashboard</a>
            <a href="#" class="nav-item">üìä Relat√≥rios</a>
            <a href="#" class="nav-item">üìÖ Calend√°rio</a>
        </div>

        <div class="nav-group">
            <span class="nav-label">Personaliza√ß√£o</span>
            <a href="#" class="nav-item">üìö Mat√©rias</a>
            <a href="#" class="nav-item">‚öôÔ∏è Configura√ß√µes</a>
        </div>

        <a href="/" class="nav-item" style="margin-top: auto;">üö™ Sair da Conta</a>
    </nav>

    <main>
        <div class="header">
            <div>
                <h1>Meu Painel de Estudos</h1>
                <p style="color: var(--text-muted)">Bem-vindo de volta! Organize suas revis√µes hoje.</p>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="main-column">
                <div class="filter-section" id="filtro-materias">
                    <button class="filter-chip active" onclick="filtrar('Todas')">Todas</button>
                    </div>

                <div id="lista-revisoes">
                    </div>
            </div>

            <div class="side-column">
                <div class="card" style="margin-bottom: 25px;">
                    <div class="stats-row">
                        <div class="stat-card">
                            <span class="stat-num" id="stat-pendente">0</span>
                            <span class="stat-desc">Pendentes</span>
                        </div>
                        <div class="stat-card" style="background: #ecfdf5;">
                            <span class="stat-num" id="stat-concluido" style="color: var(--success);">0</span>
                            <span class="stat-desc">Feitas</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">‚ûï Nova Revis√£o</div>
                    <div class="input-box">
                        <label>Mat√©ria</label>
                        <input type="text" id="materia" placeholder="Ex: Direito Civil">
                    </div>
                    <div class="input-box">
                        <label>Assunto / T√≥pico</label>
                        <input type="text" id="subtopico" placeholder="Ex: Atos Administrativos">
                    </div>
                    <div class="input-box">
                        <label>Ciclo de Revis√£o</label>
                        <select id="prazo">
                            <option value="1">Amanh√£ (24h)</option>
                            <option value="7">7 Dias</option>
                            <option value="15">15 Dias</option>
                            <option value="30">30 Dias</option>
                        </select>
                    </div>
                    <button class="btn-save" onclick="salvarNoBanco()">Agendar Agora</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        let dbDados = [];

        async function carregarDados() {
            const res = await fetch('/api/estudos');
            dbDados = await res.json();
            renderizar(dbDados);
            atualizarFiltros();
        }

        function renderizar(lista) {
            const container = document.getElementById('lista-revisoes');
            container.innerHTML = '';
            
            let p = 0; let c = 0;

            lista.forEach(item => {
                if (item.feito) { c++; } 
                else {
                    p++;
                    container.innerHTML += `
                        <div class="rev-card">
                            <div>
                                <span class="subject-badge">${item.materia}</span>
                                <span class="topic-title">${item.subtopico}</span>
                                <div class="date-tag">üìÖ Revisar em: <strong>${item.data}</strong></div>
                            </div>
                            <div class="actions">
                                <button class="btn-circle btn-check" onclick="concluir(${item.id})">‚úì</button>
                                <button class="btn-circle btn-trash" onclick="excluir(${item.id})">üóëÔ∏è</button>
                            </div>
                        </div>`;
                }
            });

            document.getElementById('stat-pendente').innerText = p;
            document.getElementById('stat-concluido').innerText = c;
        }

        function atualizarFiltros() {
            const materias = ['Todas', ...new Set(dbDados.map(r => r.materia))];
            const cont = document.getElementById('filtro-materias');
            cont.innerHTML = '';
            materias.forEach(m => {
                const active = m === 'Todas' ? 'active' : '';
                cont.innerHTML += `<button class="filter-chip ${active}" onclick="filtrar('${m}', this)">${m}</button>`;
            });
        }

        function filtrar(materia, btn) {
            document.querySelectorAll('.filter-chip').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');

            if (materia === 'Todas') renderizar(dbDados);
            else renderizar(dbDados.filter(r => r.materia === materia));
        }

        async function salvarNoBanco() {
            const m = document.getElementById('materia').value;
            const s = document.getElementById('subtopico').value;
            const d = parseInt(document.getElementById('prazo').value);
            
            if(!m || !s) return alert("Por favor, preencha os campos.");

            const data = new Date();
            data.setDate(data.getDate() + d);
            const dataStr = data.toLocaleDateString('pt-BR');

            await fetch('/api/estudos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ materia: m, subtopico: s, data: dataStr })
            });

            document.getElementById('materia').value = '';
            document.getElementById('subtopico').value = '';
            carregarDados();
        }

        async function concluir(id) {
            await fetch(`/api/estudos/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ feito: true })
            });
            carregarDados();
        }

        async function excluir(id) {
            if(confirm("Deseja apagar esta revis√£o?")) {
                await fetch(`/api/estudos/${id}`, { method: 'DELETE' });
                carregarDados();
            }
        }

        carregarDados();
    </script>
</body>
</html>
