<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstudoFlow | Gest√£o de Revis√µes</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --sidebar: #0f172a;
            --bg: #f1f5f9;
            --text: #1e293b;
            --muted: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display: flex; min-height: 100vh; }

        /* --- SIDEBAR (PONTO 2) --- */
        nav { width: 280px; background: var(--sidebar); color: white; display: flex; flex-direction: column; position: fixed; height: 100vh; padding: 30px 20px; }
        .logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-group { margin-bottom: 30px; }
        .nav-label { font-size: 0.7rem; text-transform: uppercase; color: #475569; margin-bottom: 15px; display: block; font-weight: 700; letter-spacing: 1px; }
        .nav-item { 
            padding: 12px 16px; border-radius: 12px; margin-bottom: 6px; cursor: pointer; 
            display: flex; align-items: center; gap: 12px; transition: 0.2s; color: #94a3b8; text-decoration: none; font-weight: 500;
        }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }

        /* --- CONTE√öDO --- */
        main { margin-left: 280px; padding: 40px; width: 100%; max-width: 1300px; }
        .header { margin-bottom: 35px; }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 380px; gap: 30px; }

        /* --- FILTROS --- */
        .filters { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 18px; border-radius: 100px; background: #fff; border: 1px solid #e2e8f0; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .filter-btn.active { background: var(--sidebar); color: #white; border-color: var(--sidebar); color: white; }

        /* --- CARDS E LISTA --- */
        .card { background: var(--white); border-radius: 20px; padding: 25px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .rev-item { 
            background: #fff; padding: 20px; border-radius: 18px; border: 1px solid #e2e8f0; 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; transition: 0.2s;
        }
        .rev-item:hover { border-color: var(--primary); transform: translateY(-2px); }
        .subject-tag { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; padding: 4px 10px; border-radius: 6px; background: #eef2ff; color: var(--primary); margin-bottom: 5px; display: inline-block; }
        .topic-name { font-weight: 700; font-size: 1rem; color: var(--sidebar); display: block; }
        .date-info { font-size: 0.8rem; color: var(--muted); margin-top: 6px; display: flex; align-items: center; gap: 5px; }

        /* --- RELAT√ìRIOS --- */
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .stat-box { padding: 20px; border-radius: 16px; background: #f8fafc; text-align: center; border: 1px solid #e2e8f0; }
        .stat-num { display: block; font-size: 1.8rem; font-weight: 800; color: var(--primary); }
        .stat-label { font-size: 0.75rem; font-weight: 600; color: var(--muted); text-transform: uppercase; }

        /* --- BOT√ïES --- */
        .actions { display: flex; gap: 8px; }
        .btn-action { width: 42px; height: 42px; border-radius: 12px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn-check { background: #dcfce7; color: #15803d; }
        .btn-check:hover { background: var(--success); color: #fff; }
        .btn-del { background: #fee2e2; color: #b91c1c; }
        .btn-del:hover { background: var(--danger); color: #fff; }

        .btn-save { width: 100%; padding: 16px; border-radius: 12px; border: none; background: var(--primary); color: #fff; font-weight: 700; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-save:hover { background: #4338ca; transform: translateY(-2px); box-shadow: 0 8px 15px rgba(79, 70, 229, 0.3); }

        input, select { width: 100%; padding: 14px; border: 1px solid #e2e8f0; border-radius: 12px; font-family: inherit; margin-top: 5px; margin-bottom: 15px; }
        label { font-size: 0.85rem; font-weight: 600; color: var(--muted); }
    </style>
</head>
<body>

    <nav>
        <div class="logo">üöÄ EstudoFlow</div>
        <div class="nav-group">
            <span class="nav-label">Dashboard</span>
            <a href="#" class="nav-item active">üè† Painel Principal</a>
            <a href="#" class="nav-item">üìä Relat√≥rios Detalhados</a>
            <a href="#" class="nav-item">üìÖ Calend√°rio</a>
        </div>
        <div class="nav-group">
            <span class="nav-label">Gest√£o</span>
            <a href="#" class="nav-item">üìö Mat√©rias</a>
            <a href="#" class="nav-item">‚öôÔ∏è Configura√ß√µes</a>
        </div>
        <a href="/" class="nav-item" style="margin-top: auto;">üö™ Sair</a>
    </nav>

    <main>
        <div class="header">
            <h1>Painel de Revis√£o</h1>
            <p style="color: var(--muted)">Tudo o que voc√™ precisa revisar para garantir a aprova√ß√£o.</p>
        </div>

        <div class="dashboard-grid">
            <div class="left-col">
                <div class="filters" id="filtros">
                    <button class="filter-btn active" onclick="filtrar('Todas')">Todas</button>
                </div>
                <div id="lista"></div>
            </div>

            <div class="right-col">
                <div class="card" style="margin-bottom: 25px;">
                    <div class="stats-row">
                        <div class="stat-box">
                            <span class="stat-num" id="pend-num">0</span>
                            <span class="stat-label">Pendentes</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-num" id="conf-num" style="color: var(--success)">0</span>
                            <span class="stat-label">Conclu√≠das</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 20px;">‚ûï Nova Revis√£o</h3>
                    <label>Mat√©ria</label>
                    <input type="text" id="mat" placeholder="Ex: Direito Civil">
                    <label>T√≥pico</label>
                    <input type="text" id="top" placeholder="Ex: Contratos">
                    <label>Ciclo</label>
                    <select id="ciclo">
                        <option value="1">24 Horas</option>
                        <option value="7">7 Dias</option>
                        <option value="15">15 Dias</option>
                        <option value="30">30 Dias</option>
                    </select>
                    <button class="btn-save" onclick="salvar()">Agendar Revis√£o</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        let dadosLocais = [];

        async function carregar() {
            const res = await fetch('/api/estudos');
            dadosLocais = await res.json();
            render(dadosLocais);
            geraFiltros();
        }

        function render(lista) {
            const cont = document.getElementById('lista');
            cont.innerHTML = '';
            let p = 0; let c = 0;

            lista.forEach(i => {
                if (i.feito) { c++; } 
                else {
                    p++;
                    cont.innerHTML += `
                        <div class="rev-item">
                            <div>
                                <span class="subject-tag">${i.materia}</span>
                                <span class="topic-name">${i.subtopico}</span>
                                <div class="date-info">üìÖ Revis√£o para: <strong>${i.data}</strong></div>
                            </div>
                            <div class="actions">
                                <button class="btn-action btn-check" onclick="concluir(${i.id})">‚úì</button>
                                <button class="btn-action btn-del" onclick="excluir(${i.id})">üóëÔ∏è</button>
                            </div>
                        </div>`;
                }
            });
            document.getElementById('pend-num').innerText = p;
            document.getElementById('conf-num').innerText = c;
        }

        function geraFiltros() {
            const mats = ['Todas', ...new Set(dadosLocais.map(r => r.materia))];
            const div = document.getElementById('filtros');
            div.innerHTML = '';
            mats.forEach(m => {
                div.innerHTML += `<button class="filter-btn" onclick="filtrar('${m}', this)">${m}</button>`;
            });
        }

        function filtrar(m, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            render(m === 'Todas' ? dadosLocais : dadosLocais.filter(r => r.materia === m));
        }

        async function salvar() {
            const materia = document.getElementById('mat').value;
            const subtopico = document.getElementById('top').value;
            const dias = parseInt(document.getElementById('ciclo').value);
            if(!materia || !subtopico) return;

            const d = new Date(); d.setDate(d.getDate() + dias);
            const dataStr = d.toLocaleDateString('pt-BR');

            await fetch('/api/estudos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ materia, subtopico, data: dataStr })
            });

            document.getElementById('mat').value = '';
            document.getElementById('top').value = '';
            carregar();
        }

        async function concluir(id) {
            await fetch(`/api/estudos/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ feito: true })
            });
            carregar();
        }

        async function excluir(id) {
            if(confirm("Excluir?")) {
                await fetch(`/api/estudos/${id}`, { method: 'DELETE' });
                carregar();
            }
        }

        carregar();
    </script>
</body>
</html>
